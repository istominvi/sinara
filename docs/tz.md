# ТЗ (предварительное) — **Cinara.ru (Синара)**: методики + онлайн-уроки + ДЗ

**Версия:** 0.4  
**Дата:** 2026-02-10  
**Домен/бренд:** Cinara.ru (по-русски: «Синара»)  
**Стек:** Next.js (App Router) / Tailwind / shadcn/ui / Supabase (Auth + Postgres + Storage + Edge Functions)  
**Оплата:** YooKassa или PayAnyWay (РФ), рекуррентные платежи/автоплатежи

---

## 1) Суть продукта

**Cinara.ru (Синара)** — SaaS-платформа для учителей и школ: продажа подписки на доступ к **методикам преподавания китайского языка** + инструменты для:
- проведения онлайн-уроков (встроенный видеозвонок “как Zoom”),
- выдачи домашнего задания (ДЗ) на основе методики,
- контроля прогресса и аналитики,
- общения учителя и ученика,
- обучения словарю (карточки + аудио).

Ключевые принципы:
- **Методика** — контент **только для учителя** (как проводить урок).
- **Ученик** не покупает подписку и не видит методику/уроки напрямую — он видит **расписание, занятия, ДЗ, словарь, сообщения, прогресс**.
- Онлайн-уроки и ДЗ строятся вокруг уроков методики, но ученик работает только с назначенными сущностями.

---

## 2) Роли и “школа” без сложных ролей

### 2.1 Роли (упрощённо)
- **Гость**
- **Учитель**
- **Ученик**
- **Админ платформы** (внутренний)

> “Школа” реализуется как **Workspace/Организация**, а не отдельная «сложная роль». Любой учитель может создать Workspace, оплатить план на места (seats) и пригласить других учителей.

### 2.2 Workspace/Организация (“школа”)
Workspace хранит:
- подписку (план, seats),
- список учителей-участников,
- настройки кастомизации бренда (см. 16).

Минимальный интерфейс (без тяжёлой админки):
- **Настройки → Команда**
  - создать Workspace
  - пригласить учителей по email
  - список участников (Owner/Admin/Member), счётчик seats used/limit
- **Настройки → Оплата**
  - текущий план, статус, период
  - покупка/продление

Поведение seats:
- принятие инвайта учителем → занимает 1 seat
- если seats нет → показать “нужно докупить места/план”

---

## 3) Публичная часть (лендинг) и вход

### 3.1 Лендинг
При заходе на **Cinara.ru** — landing page.

### 3.2 Вход (dropdown + модалка)
Кнопка **«Вход»** справа сверху:
- hover → dropdown:
  - “Вход”
  - “Ученик”
  - “Учитель”
- любой клик открывает модалку с 2 вкладками: **Ученик / Учитель**
- если клик по пункту dropdown — вкладка предвыбрана

### 3.3 Регистрация
**Ученик:** телефон + email + пароль + имя  
**Учитель:** email + пароль + имя

---

## 4) Методики и уроки (teacher-only)

### 4.1 MVP контент
- 1 методика (начальные классы)
- 80 уроков

### 4.2 Что есть в уроке методики (для учителя)
Урок содержит:
- план/сценарий проведения (текст)
- материалы для урока:
  - презентация (обязательна)
  - видео/аудио (если есть)
- шаблон ДЗ (см. раздел 7)
- слова урока (см. раздел 10)

### 4.3 URL (учитель)
- методика: `/teacher/methodics/[methodicSlug]`
- урок: `/teacher/methodics/[methodicSlug]/lessons/[lessonNumberOrSlug]`

Ученик страниц методики/уроков **не видит**.

---

## 5) Доступ к методикам и защита контента

### 5.1 Планы
- Индивидуальная подписка учителя: **990 ₽/мес**
- Workspace “школа”: **3900 ₽/мес за 5 мест**

### 5.2 Paywall методик
Учитель без активного доступа (нет личной подписки и не состоит в Workspace с активным plan):
- видит методику,
- полностью доступен только 1 урок,
- остальные закрыты + CTA “Оформить подписку/план”.

### 5.3 Защита материалов (обязательно)
Цель: материалы методики не должны быть общедоступными, легко скачиваемыми, и их нельзя было “просто переслать по ссылке”.

Реализация:
- Supabase Storage: **private buckets**
- выдача доступа через **короткоживущие signed URL** (TTL 60–180 сек) после проверки прав (server action/edge function)
- логирование выдачи signed URL и rate-limit
- для презентаций/медиа — встроенный viewer/плеер без прямого “скачать”

Ограничение: 100% защита невозможна (скринрекорд), но пересылка ссылок становится бесполезной.

---

## 6) Онлайн-уроки (встроенный Zoom-подобный вебинар)

### 6.1 Требования
В системе должны быть **онлайн-уроки по расписанию**:
- учитель ↔ группа учеников или учитель ↔ ученик
- видеосвязь (камера/микрофон), чат
- **демонстрация экрана** (учитель)
- учитель демонстрирует презентацию урока и ведёт занятие

### 6.2 Технический вариант (MVP-подход)
MVP: встраивание готового WebRTC решения:
- **Jitsi Meet IFrame API** (можно self-host).  
С возможностью перехода на более “платформенный” вариант (LiveKit) позже.

Требования к комнатам:
- комната создаётся автоматически для каждого занятия
- доступ только участникам занятия (teacher + assigned students)
- внутренний роут: `/classrooms/[sessionId]`
- учитель может запускать и завершать занятие

---

## 7) Домашние задания (ДЗ): шаблон из методики + индивидуальные настройки

### 7.1 Шаблон ДЗ в методике
У каждого урока есть `homework_template`:
- видео: N просмотров
- аудио: N прослушиваний
- презентация: требования (см. 8.4)
- текстовое задание (опционально)
- словарь/слова урока (см. 10)

### 7.2 Выдача ДЗ учителем
Учитель выдаёт ДЗ:
- ученику или группе
- по умолчанию — по шаблону урока
- может:
  - выставить разное число повторений каждому ученику (override)
  - добавить индивидуальный комментарий
  - добавить/изменить текст-задание (минимум поле “доп. задание”)

### 7.3 Что видит ученик
Ученик видит **только** назначенные ДЗ + расписание занятий + сообщения + словарь/прогресс.

---

## 8) Трекинг выполнения ДЗ (античит)

### 8.1 Общая логика
Система пишет события взаимодействия ученика с материалами ДЗ и считает прогресс.

### 8.2 Видео
1 просмотр засчитывается, если просмотрено ≥ 80% (порог настраиваемый).

### 8.3 Аудио
1 прослушивание засчитывается, если прослушано ≥ 80% (порог настраиваемый).

### 8.4 Презентация (строго)
Требования:
- пролистать до конца
- фиксировать время по каждому слайду
- античит-правила (настраиваемые): минимум времени на слайд и/или суммарное время

Рекомендуемая реализация:
- PDF viewer (pdf.js)
- события `slide_enter/slide_leave`, `duration_ms`
- “выполнено” только при достижении последнего слайда + выполнении порогов времени

### 8.5 Текстовое задание
Если включено:
- ученик должен отправить текст
- ДЗ не выполнено, пока текст не отправлен
(проверка учителем “принято/не принято” — Phase 2)

---

## 9) Расписание (календарь занятий)

### 9.1 Учитель
- создание занятия для группы или ученика
- дата/время, длительность
- привязка к уроку методики (lesson_id)
- ссылка “Присоединиться” открывает комнату

### 9.2 Ученик
- видит ближайшие занятия и список
- видит с каким учителем и какой группой/индивидуально
- “Присоединиться” в момент занятия

---

## 10) Словарь и карточки (300 слов)

### 10.1 Контент
- в первой методике ~300 слов
- слова распределены по урокам
- у слова есть аудио произношения

### 10.2 Тренажёр в ДЗ (обязательное правило)
Механика:
- ученику проигрывается аудио слова
- на экране карточки (варианты), ученик выбирает правильную
- пока не угадает **все слова урока** — ДЗ “словарь” не выполнено

MVP минимум:
- 4–6 вариантов карточек
- фиксировать ошибки/попытки
- завершение: все слова набора помечены “угадано”

### 10.3 Личный словарь ученика
- список всех слов курса
- статусы: new/learning/learned
- статистика: correct/wrong, last_seen_at

---

## 11) Редактирование уроков учителем + откат + ИИ

### 11.1 Override плана урока
Учитель может:
- изменить текст плана урока “для себя” (override)
- откатить к оригиналу

### 11.2 ИИ-редактирование
- кнопка “Изменить с помощью ИИ”
- запрос → генерация варианта → предпросмотр → принять/отклонить
- сохранение как override
- (желательно) история версий (минимум оригинал + последняя версия)

---

## 12) Сообщения (двусторонние)
- учитель → ученик/группа
- ученик → учитель
- формат диалогов/conversations

---

## 13) Оплата (YooKassa / PayAnyWay)
- индивидуальная подписка 990 ₽/мес
- школьный план 3900 ₽/мес (5 мест)
- webhooks обновляют статусы
- хранить provider ids + current_period_end

---

## 14) Админка (простая)
Админка платформы:
- методики/уроки (CRUD)
- материалы (загрузка/привязка)
- словарь (CRUD + привязка к урокам)
- шаблоны ДЗ уроков
- пользователи/Workspace/подписки (минимально)

---

## 15) Подготовка к мульти-тенантности и кастомизации школ (НЕ MVP, но заложить сразу)

### 15.1 Цель кастомизации
Школы (Workspace) с подпиской должны иметь возможность **минимально “забрендировать”** интерфейс Cinara.ru:
- логотип школы
- основные цвета (brand primary/secondary)
- (опционально) название школы в шапке/входе
- (опционально) кастомная ссылка вида `school.cinara.ru` или `cinara.ru/s/<slug>` (Phase 2)

**Важно:** это не white-label с отдельным продуктом, а **мульти-тенант бренд-настройки**, влияющие на тему/логотип и частично UI.

### 15.2 Как это должно работать концептуально
- По умолчанию пользователь видит базовый бренд Cinara.ru.
- Если пользователь входит в контексте Workspace (например, по `cinara.ru/s/<workspaceSlug>` или по инвайт-ссылке школы):
  - применяется тема Workspace (логотип/цвета)
  - в заголовке/страницах можно показывать “Школа: <name>”
- Учителя и ученики, прикреплённые к Workspace, в кабинете могут видеть бренд школы (если включено).

### 15.3 Минимальный набор бренд-настроек (на будущее)
`workspace_branding`:
- `logo_path` (storage private/public — по решению)
- `brand_primary_color` (hex)
- `brand_secondary_color` (hex)
- `brand_name` (display)
- `theme_mode` (light/dark/auto)
- `custom_domain` (nullable, Phase 2)
- `slug` (для маршрута `/s/<slug>`)

Правила применения:
- при загрузке приложения определяется “active workspace context”:
  - по поддомену (Phase 2) **или**
  - по префиксу в URL `/s/<slug>` (рекомендуемо заложить) **или**
  - по последнему выбранному workspace пользователя (если он состоит в нескольких)
- далее применяется CSS-тема (Tailwind CSS variables) + логотип.

### 15.4 Ограничения безопасности и приватности
- branding не должен раскрывать закрытые материалы
- ученик не может переключать школы вручную, если не связан с учителем/Workspace

---

## 16) Предложение по модели данных (добавления)

### 16.1 Workspaces + branding
`workspaces`
- id, slug, title, owner_user_id, created_at

`workspace_members`
- workspace_id, user_id, role (owner|admin|member), created_at

`workspace_branding`
- workspace_id (pk/fk)
- brand_name
- logo_path
- brand_primary_color
- brand_secondary_color
- theme_mode
- custom_domain (nullable, Phase 2)
- updated_at

### 16.2 Подписки
`subscriptions`
- id
- owner_type (workspace|teacher_personal)
- owner_id
- plan (teacher_990|workspace_3900_5)
- seat_limit
- status
- provider
- provider_subscription_id
- current_period_end

### 16.3 Расписание/занятия
`class_sessions`
- id
- workspace_id
- teacher_id
- lesson_id (nullable)
- starts_at, duration_min
- target_type (student|group)
- target_id
- meeting_provider (jitsi|livekit)
- meeting_room_key
- status (scheduled|live|finished|canceled)

### 16.4 Словарь
`words`, `lesson_words`, `student_word_progress`

### 16.5 ДЗ и трекинг
`assignments`, `assignment_events`, `assignment_text_answers`, overrides

### 16.6 Override уроков учителя
`lesson_overrides` (+ опциональная история версий)

---

## 17) MVP Scope (фиксируем, что branding позже)
### Must-have (MVP)
- всё ранее описанное: вход, кабинеты, методики+paywall, защита материалов, ученики/группы, ДЗ+трекинг, словарь, расписание, встроенный видеозвонок, сообщения, оплата, простая админка
### Не в MVP, но заложить в БД/архититектуру
- `workspaces.slug` и `workspace_branding`
- концепция “workspace context” для темы/логотипа
- возможность маршрута `/s/<slug>` (можно заглушкой)

---

## 18) Размещение файла в репозитории
- `docs/tz.md` — это ТЗ
- `docs/roadmap.md` — этапы (см. [roadmap](./roadmap.md))
- `docs/db-schema.md` — схема БД (после фиксации)
