# ТЗ (предварительное) — Sinara (cinara.ru): SaaS методик преподавания китайского языка

**Версия:** 0.2  
**Дата:** 2026-02-09  
**Домен:** cinara.ru  
**Стек:** Next.js (App Router) / Tailwind / shadcn/ui / Supabase (Auth + Postgres + Storage + Edge Functions)  
**Оплата:** YooKassa или PayAnyWay (РФ), подписка рекуррентная

---

## 1) Цели продукта и позиционирование

Sinara — SaaS-платформа для продажи подписки **учителям** и **школам** на доступ к методикам преподавания китайского языка.

Ключевая ценность:
- Учитель получает доступ к методике преподавания (контент **только для преподавателя**).
- Ученик получает доступ **только к домашним заданиям**, которые ему выдаёт учитель.
- Система фиксирует выполнение ДЗ (просмотры/прослушивания/прочее) и показывает прогресс учителю.

---

## 2) Роли и права доступа

### 2.1 Роли
- **Гость** (лендинг)
- **Учитель**
- **Ученик**
- **Школа (Организация)**:
  - **School Admin** — управляет подпиской/местами (seats) и распределяет их учителям
- **Админ платформы** (внутренний): управление контентом методик + модерация + поддержка

### 2.2 Модель подписки и доступа
- **Ученик подписку не покупает.**  
  Он видит только то, что выдал учитель (ДЗ и сообщения).
- Доступ к методикам для учителя определяется:
  - **индивидуальной подпиской** (990 ₽/мес), или
  - **школьной подпиской** (3900 ₽/мес за 5 мест), когда школа выдаёт учителю место.
- Учитель без подписки: доступ к методикам ограничен (см. 6.2).

---

## 3) Публичная часть сайта (лендинг) и вход

### 3.1 Главная (Landing Page)
При заходе на cinara.ru пользователь попадает на лендинг:
- в правом верхнем углу кнопка **«Вход»**.

### 3.2 UX входа через dropdown + модалку
Поведение кнопки «Вход»:
- при наведении (hover) раскрывается dropdown:
  - Заголовок/кнопка: **«Вход»**
  - Пункты: **«Ученик»**, **«Учитель»**
- Любое действие (клик по «Вход», «Ученик», «Учитель») открывает **модалку** с двумя вкладками:
  - **Ученик**
  - **Учитель**
- Если клик был по пункту dropdown («Ученик»/«Учитель») — соответствующая вкладка **предвыбрана**.

### 3.3 Авторизация/регистрация
Модалка содержит:
- Вход (логин)
- Регистрация
- Восстановление пароля

**Ученик при регистрации указывает:**
- телефон
- e-mail
- пароль
- ФИО (минимум: имя)

**Учитель при регистрации (минимум):**
- e-mail
- пароль
- ФИО/название (минимум: имя)

После входа:
- Учитель попадает в кабинет Учителя
- Ученик попадает в кабинет Ученика  
Интерфейсы полностью разные.

---

## 4) Методики и уроки (контентная модель)

### 4.1 MVP
- В системе изначально **1 методика** для начальных классов.
- В методике **80 уроков**.

### 4.2 Структура урока (важно: разделение teacher vs homework)
Каждый урок методики включает:
1) **Контент методики для учителя** (teacher-only):
   - текст методики (как проводить урок)
   - презентации/видео/аудио для демонстрации учителем (если нужно)
2) **Шаблон ДЗ урока (по умолчанию)** — набор требований для ученика, задаётся методикой:
   - например: “прослушать аудио 10 раз”, “посмотреть видео 3 раза”, “написать ответ/текст”, и т.д.

**Принцип:** ученический контент **не показывается учителю как “ученический интерфейс”**, но в методике хранится шаблон требований ДЗ, который учитель затем выдаёт ученикам (с возможностью индивидуально менять требования).

### 4.3 URL страниц
- Страница методики: `/methodics/[methodicSlug]`
- Страница урока (учитель): `/teacher/methodics/[methodicSlug]/lessons/[lessonNumberOrSlug]`

**Ученик не имеет прямого доступа к страницам методики/уроков.**  
Ученик работает только с сущностью “Домашнее задание”.

---

## 5) Кабинет Учителя

Разделы:
- **Методики**
- **Ученики**
- **Обучение** (вебинары/семинары/конференции — позже, но каркас заложить)
- (опционально) **Подписка/Оплата**

### 5.1 Раздел “Методики”
Функции:
- список методик (MVP: 1)
- просмотр уроков методики (80)
- просмотр содержания урока (teacher-only контент)

### 5.2 Paywall для методик
- Учитель **без активной подписки**:
  - видит методику,
  - видит **полностью только 1 урок**,
  - остальные уроки недоступны (заглушка + CTA “Оформить подписку”).
- Учитель **с активной подпиской**:
  - доступ ко всем 80 урокам.

### 5.3 Раздел “Ученики” (индивидуальные + группы)
Функции:
- список учеников
- список групп
- фильтрация/сортировка:
  - по группам
  - по прогрессу
  - по активности
  - по статусу (активен/архив)
- объединение в группы, управление составом

### 5.4 Добавление ученика к учителю (2 способа)
1) **По телефону или e-mail ученика**  
   Учитель вводит телефон/e-mail → если ученик зарегистрирован, создаётся связь Teacher ↔ Student.
2) **Инвайт-ссылка**
   - Учитель генерирует инвайт
   - ссылка “красивая и короткая” (реализация: slug + редирект)
   - ученик открывает ссылку → логин/регистрация → автоматически привязывается к учителю

Инвайт должен иметь:
- срок действия (например, 7 дней) или возможность отключить
- ограничение на использование (1 раз или N раз — по настройке; по умолчанию N раз)

### 5.5 Домашние задания: выдача ученикам
Учитель проводит урок (как вебинар/занятие вне рамок “методики на сайте”) и затем выдаёт ДЗ.

Логика ДЗ:
- в методике у каждого урока есть **шаблон ДЗ по умолчанию**
- при выдаче ДЗ учитель может:
  - выдать задание ученику или группе
  - **индивидуально выставить количество повторений каждому ученику**
  - добавить индивидуальный комментарий/дополнительный текст задания
  - при необходимости отключить часть требований шаблона или добавить новые (MVP: минимум — override чисел + комментарий)

### 5.6 Аналитика прогресса (Учитель)
Учитель видит:
- прогресс ученика **по выполнению ДЗ**:
  - по каждому выданному ДЗ
  - суммарно по всей методике (агрегация по урокам/ДЗ)
- прогресс группы (сводная таблица)

---

## 6) Кабинет Ученика

Разделы:
- **Домашнее задание**
- **Отчет преподавателя** (минимально/позже)
- **Сообщения**
- **Прогресс**

### 6.1 Что видит ученик
Ученик видит **только ДЗ**, которые ему **разрешил/выдал** учитель.  
Никаких списков уроков/методик ученик не видит.

### 6.2 Выполнение ДЗ (ядро MVP)
Внутри ДЗ ученик выполняет требования, заданные методикой + скорректированные учителем:
- видео: посмотреть N раз
- аудио: прослушать N раз
- презентация: пролистать до конца + трекинг времени на каждом слайде
- “написать” (текст/ответ): отправка текста в ДЗ (MVP поддержать)

---

## 7) Трекинг выполнения ДЗ (просмотры/прослушивания/презентации)

### 7.1 Общие принципы
Система фиксирует события взаимодействия ученика с материалами ДЗ и считает выполнение требований.

### 7.2 Видео
Засчитывается 1 просмотр, если:
- ученик запустил видео
- и дошёл до конца или просмотрел ≥ X% (рекомендуемо 80%)

### 7.3 Аудио
Засчитывается 1 прослушивание, если:
- ученик запустил аудио
- и прослушал ≥ X% (рекомендуемо 80%)

### 7.4 Презентация (обязательно детально)
Требования:
- презентация должна быть пролистана **до конца**
- нужно регистрировать **время на каждом слайде**
- античит:
  - нельзя засчитать выполнение, если пролистывание слишком быстро (правило настраиваемое, например “минимум N секунд в среднем/на ключевых слайдах”)

Реализация (рекомендуемая для MVP):
- презентация хранится как PDF → при показе в кабинете ученика:
  - рендер в viewer (pdf.js) или конвертация в изображения
  - трекинг: `slide_index`, `enter_time`, `leave_time`, `duration_ms`
- факт выполнения презентации:
  - достигнут последний слайд
  - суммарное время ≥ заданного порога (или по слайдам)

### 7.5 Текстовое задание (“написать”)
- ученик отправляет текст (message/answer) внутри ДЗ
- учитель видит ответы в аналитике по ДЗ

---

## 8) Сообщения (двусторонние)

### 8.1 Учитель → ученик/группа
- отправка сообщения одному ученику
- отправка сообщения группе (массовая)

### 8.2 Ученик → учитель
- ученик может отвечать на сообщения учителя в кабинете

Формат: “чат-переписка” или “тред” (для MVP можно упрощённо как диалог).

---

## 9) Подписки и биллинг (YooKassa / PayAnyWay)

### 9.1 Тарифы
- **Индивидуальная подписка учителя:** 990 ₽ / месяц
- **Школа:** 3900 ₽ / месяц за 5 мест (5 учительских доступов)

### 9.2 Роль “Школа” и seats
Школа покупает подписку и получает пул мест (seats):
- School Admin распределяет места между учителями (пользователями с ролью Teacher)
- Учитель “при школе” доступ получает бесплатно, индивидуально ничего не платит
- Если у школы подписка не активна → доступ у всех учителей школы отключается (или переводится в ограниченный режим)

### 9.3 Интеграция оплаты
Требования:
- сразу интегрируем оплату (YooKassa или PayAnyWay)
- поддержка рекуррентных платежей (если провайдер это поддерживает в выбранной схеме)
- webhook-обновление статусов подписки:
  - active / past_due / canceled / expired
- хранение:
  - provider (yookassa|payanyway)
  - customer_id / subscription_id (или аналоги)
  - status
  - current_period_end

---

## 10) Защита материалов методик (обязательное)

Цель: материалы методики не должны быть общедоступными, “легко скачиваемыми” и передаваемыми по прямой ссылке.

### 10.1 Хранение
- материалы (видео/аудио/презентации) хранятся в **Supabase Storage** в **private bucket**
- прямой публичной ссылки нет

### 10.2 Доступ через краткоживущие ссылки
- выдача **signed URL** на короткий срок (например, 60–180 секунд) через backend (Edge Function / server action)
- подписанная ссылка генерируется только после проверки прав:
  - учитель: есть активная подписка или seat от школы
  - ученик: есть назначенное ДЗ и доступ разрешён учителем

### 10.3 Запрет “передачи ссылки”
- signed URL быстро протухает
- дополнительно:
  - привязка выдачи к пользователю/assignment_id (логическая, через проверку выдачи)
  - rate limiting (ограничение частоты выдачи ссылок)
  - отключить listing / запретить публичные ACL

### 10.4 Реалистичное ограничение
Полностью исключить копирование невозможно (скринрекордер/скриншоты), но система:
- делает прямой “скачать по URL” максимально неудобным
- лишает смысла пересылку ссылок (короткий TTL + проверка прав)
- фиксирует подозрительную активность (опционально: много выдач ссылок/просмотров)

---

## 11) Админка (встроенная, простая)

Нужна отдельная админка на сайте (MVP — минимальная).

### 11.1 Функции админа платформы (MVP)
- CRUD методик / уроков
- загрузка/привязка материалов к урокам
- управление шаблонами ДЗ уроков (дефолтные требования)
- просмотр пользователей и ролей
- управление подписками (если нужно ручное вмешательство)
- просмотр платежных статусов (read-only + синхронизация через webhook)

---

## 12) Нефункциональные требования

### 12.1 Безопасность данных (Supabase RLS)
- строгие политики RLS:
  - учитель видит только своих учеников/группы/ДЗ/сообщения
  - ученик видит только свои ДЗ/сообщения/события
  - школа видит только своих учителей и свои seats/подписку
- admin role — только для сотрудников/владельца проекта

### 12.2 Логи и аудит
MVP минимум:
- логирование событий трекинга ДЗ
- логирование выдачи signed URL (опционально)

### 12.3 Производительность
- пагинация сообщений/списков учеников
- lazy load медиа и презентаций

---

## 13) Предлагаемая модель данных (черновик)

### 13.1 Профили
`profiles`
- id (uuid = auth.users.id)
- role (teacher|student|school_admin|admin)
- name
- email
- phone (для student обязательно)
- created_at

### 13.2 Школы и места
`schools`
- id
- title
- created_at

`school_members`
- school_id
- user_id (teacher)
- role (teacher|school_admin)
- created_at

`school_seats`
- id
- school_id
- seat_limit (например 5)
- seat_used
- status (active|inactive)
- current_period_end

### 13.3 Подписки
`subscriptions`
- id
- owner_type (teacher|school)
- owner_id (teacher_id или school_id)
- plan (teacher_990|school_3900_5)
- provider (yookassa|payanyway)
- provider_customer_id
- provider_subscription_id
- status (active|past_due|canceled|expired)
- current_period_end
- created_at

### 13.4 Методики и уроки
`methodics`
- id, slug, title, description

`lessons`
- id, methodic_id, number, slug, teacher_content_md

`lesson_assets`
- id, lesson_id
- type (video|audio|presentation)
- title
- storage_path (private) / external_url (если будет)
- duration_seconds (nullable)

### 13.5 Шаблон ДЗ урока (в методике)
`lesson_homework_templates`
- id, lesson_id
- required_video_views (int)
- required_audio_plays (int)
- required_presentation_views (int)  // обычно 1, но можно иначе
- requires_text_answer (bool)
- default_text_prompt (text, nullable)

### 13.6 Связь учителя и ученика
`teacher_students`
- id
- teacher_id
- student_id
- created_at

`groups`
- id
- teacher_id
- title
- created_at

`group_members`
- group_id
- student_id

### 13.7 Домашние задания (выданные)
`assignments`
- id
- teacher_id
- student_id (nullable)
- group_id (nullable)
- lesson_id
- // “фактические требования” с учётом шаблона и overrides:
- required_video_views (int)
- required_audio_plays (int)
- required_presentation_views (int)
- requires_text_answer (bool)
- teacher_comment (text, nullable)
- due_at (nullable)
- created_at
- status (assigned|done|archived)

`assignment_student_overrides` (если выдача группе с разными нормами)
- assignment_id
- student_id
- required_video_views
- required_audio_plays
- required_presentation_views
- teacher_comment (nullable)

### 13.8 Трекинг событий (ученик)
`assignment_events`
- id
- assignment_id
- student_id
- asset_type (video|audio|presentation)
- event_type (play|progress|complete|slide_enter|slide_leave)
- progress_percent (nullable)
- duration_seconds (nullable)
- slide_index (nullable)
- slide_duration_ms (nullable)
- created_at

`assignment_text_answers`
- id
- assignment_id
- student_id
- text
- created_at

### 13.9 Сообщения
`conversations`
- id
- teacher_id
- student_id (или group_id для группового треда — по решению)
- created_at

`messages`
- id
- conversation_id
- sender_id
- body
- created_at

---

## 14) MVP Scope (обязательное)

### Must-have
- Лендинг + вход через dropdown + модалка (вкладки Ученик/Учитель)
- Регистрация/логин (student: phone+email)
- Учитель:
  - методика 1 + 80 уроков (teacher-only контент)
  - paywall (полный доступ только при подписке/seat)
  - ученики/группы + добавление по email/телефону + инвайт-ссылка
  - выдача ДЗ (с шаблоном из методики) + индивидуальные overrides
  - аналитика выполнения ДЗ (по ученику/группе + суммарно по методике)
  - сообщения (двусторонние)
- Ученик:
  - список ДЗ
  - выполнение ДЗ + трекинг видео/аудио + презентации со временем по слайдам
  - ответы “написать текст”
  - сообщения (ответ учителю)
- Оплата:
  - интеграция YooKassa/PayAnyWay
  - webhook-статусы подписки
- Админка:
  - простая: контент методик/уроков + шаблоны ДЗ + материалы

### Should-have (можно сразу, если успеваем)
- базовый кабинет школы (распределение мест учителям)
- отчёт преподавателя (как отдельная сущность)

---

## 15) Критерии приёмки (коротко)

1) На лендинге кнопка “Вход” раскрывает dropdown; клик открывает модалку с вкладками Ученик/Учитель, с предвыбором при клике из dropdown.  
2) Учитель без подписки видит полностью только 1 урок; остальные закрыты.  
3) Ученик не видит методики/уроки, видит только выданные ДЗ.  
4) ДЗ формируется из шаблона методики, учитель может переопределить требования индивидуально ученику.  
5) Трекинг: видео/аудио засчитываются по правилу прогресса, презентация — только после достижения последнего слайда + есть время по каждому слайду.  
6) Учитель видит прогресс выполнения ДЗ и суммарно по методике.  
7) Подписка учителя 990 ₽/мес и школа 3900 ₽/мес за 5 мест работают через YooKassa/PayAnyWay (статусы обновляются webhooks).  
8) Материалы хранятся приватно и выдаются через краткоживущие signed URL после проверки прав.

---

## 16) Рекомендуемое размещение файла ТЗ в репозитории

- `docs/tz.md` — текущее ТЗ (этот документ)
- `docs/roadmap.md` — этапы
- `docs/db-schema.md` — схема БД (после фиксации)

---
